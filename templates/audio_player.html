<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Audio - {{ filename }}</title>
		<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
		<link rel="stylesheet" href="{{ url_for('static', filename='audio_player/style.css') }}">
		<script src="{{ url_for('static', filename='theme.js') }}" defer></script>
	</head>
	<body>
		<header>
			<h1>{{ filename }}</h1>
			<div>
				<a href="{{ url_for('main') }}">‚Üê Back</a>
				<button onclick="toggleTheme()">Theme</button>
			</div>
		</header>
		<main class="audio-container">
			<div class="audio-meta">
				<div class="audio-title">{{ filename }}</div>
			</div>
			<audio id="audio" class="audio-player" preload="metadata">
				<source src="{{ audio_url }}">
				Your browser does not support the audio element.
			</audio>

			<div class="audio-controls">
				<button id="playBtn" class="btn">Play</button>
				<div class="progress-wrap" id="progressWrap">
					<div class="progress" id="progress">
						<div class="progress-filled" id="progressFilled"></div>
					</div>
				</div>
				<div class="time" id="time">0:00 / 0:00</div>
				<input id="volume" class="volume" type="range" min="0" max="1" step="0.01" value="1" aria-label="Volume">
				<a class="btn primary download" href="{{ url_for('media_file', media_type='audios', filename=filename) }}" download>Download</a>
			</div>
		</main>

		<script>
		const audio = document.getElementById('audio');
		const playBtn = document.getElementById('playBtn');
		const progress = document.getElementById('progress');
		const progressFilled = document.getElementById('progressFilled');
		const timeEl = document.getElementById('time');
		const volumeEl = document.getElementById('volume');


		function formatTime(sec){
			if (!sec || isNaN(sec)) return '0:00';
			const s = Math.floor(sec % 60).toString().padStart(2,'0');
			const m = Math.floor(sec/60);
			return `${m}:${s}`;
		}

		audio.addEventListener('loadedmetadata', ()=>{
			timeEl.textContent = `${formatTime(0)} / ${formatTime(audio.duration)}`;
		});

		audio.addEventListener('timeupdate', ()=>{
			const percent = (audio.currentTime / audio.duration) * 100 || 0;
			progressFilled.style.width = percent + '%';
			timeEl.textContent = `${formatTime(audio.currentTime)} / ${formatTime(audio.duration)}`;
		});

		playBtn.addEventListener('click', ()=>{
			if (audio.paused) { audio.play(); playBtn.textContent = 'Pause'; }
			else { audio.pause(); playBtn.textContent = 'Play'; }
		});

		progress.addEventListener('click', (e)=>{
			const rect = progress.getBoundingClientRect();
			const x = e.clientX - rect.left;
			const pct = x / rect.width;
			audio.currentTime = pct * audio.duration;
		});

		volumeEl.addEventListener('input', ()=>{ audio.volume = volumeEl.value; });

		// spacebar toggles play/pause
		document.addEventListener('keydown', (e)=>{
			if (e.code === 'Space' && document.activeElement.tagName !== 'INPUT'){
				e.preventDefault();
				if (audio.paused) { audio.play(); playBtn.textContent = 'Pause'; } else { audio.pause(); playBtn.textContent = 'Play'; }
			}
		});
		</script>
	</body>
</html>

